#include "gd32e10x.h"#include "lora.h"#include "sx127x_Drive.h"#include "loraDealDat.h"#include "hardware.h"/* 初始化Lora传感器*/void InitLora(void){	G_LoRaConfig.BandWidth = BW125KHZ;    //BW = 125KHz  BW125KHZ	G_LoRaConfig.SpreadingFactor = SF09;  //SF = 9	G_LoRaConfig.CodingRate = CR_4_6;     //CR = 4/6	G_LoRaConfig.PowerCfig = 15;          //19±1dBm	G_LoRaConfig.MaxPowerOn = TRUE;       //最大功率开启	G_LoRaConfig.CRCON = TRUE;            //CRC校验开启	G_LoRaConfig.ExplicitHeaderOn = TRUE; //Header开启	gpio_init(GPIOB,GPIO_MODE_OUT_PP,GPIO_OSPEED_10MHZ,GPIO_PIN_10 | GPIO_PIN_11);	if(SX127X_Lora_init() != NORMAL)	{	 //无线模块初始化			SX127X_StartRx();	}}/* 发送Lora数据包*/void SendLoraDatPack(u8 *buf,u8 len){	G_LoRaConfig.PayloadLength=len;	SX127X_TxPacket(buf);}/*	LoRa循环查询是否有数据到达*/u8 LoraDatPro(void){	u8 recFlag = 0;	//接收长度	u8 recLen = 0;		SX127X_Read(REG_LR_IRQFLAGS,&recFlag);	//数据到达	if(recFlag)	{		//清除中断标志		SX127X_Write(REG_LR_IRQFLAGS,0xFF);				if(recFlag & RFLR_IRQFLAGS_TXDONE)		{//发送完成转接收			SX127X_StartRx();		}				if(recFlag & RFLR_IRQFLAGS_RXDONE)		{			RFLED_ENABLE;			//长度在G_LoRaConfig.PayloadLength;			SX127X_RxPacket(loraRecBuf);			recLen = G_LoRaConfig.PayloadLength;			//获取当前信道中的RSSI值			s16 rssi = SX127X_Current_RSSI();			//printf("LoRaRecLen:%d,SNR:%d,RSSIC:%d,%d\r\n",recLen,G_LoRaPara.Packet_SNR,(s16)G_LoRaPara.Packet_RSSI,rssi);						}		SX127X_Read(REG_LR_IRQFLAGS, &recFlag);    if(recFlag)		{ 			InitLora();    }	}		return recLen;}